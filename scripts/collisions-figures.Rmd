
```{r}
library(tidyverse)
```


```{r}

crossing(variants=c(1e3,5e3,1e4),replicates=c(1,3,10),barcode_length=c(16,20)) %>% 
    mutate(freqs=pmap(list(variants,replicates,barcode_length),
        function(x,y,z){
            tibble(freq=dpois(0:1e4,choose(y*x,2)*(4^-z)*choose(z,4)),
                collisions=0:1e4
                )
        }))%>%
    unnest() %>% mutate(expected_collisons=freq*variants*collisions) %>% 
    group_by(variants,replicates,barcode_length) %>% 
    summarize(expected_collisons=sum(expected_collisons)) %>% 
    mutate(lambda=expected_collisons/(variants*replicates)) %>%
    mutate(collisons_per_variant=1-ppois(0,lambda,lower.tail=T)) %>%
    arrange(barcode_length,replicates,variants)
    

```



```{r}
sqrt(pi*(4^6)/2)
```

